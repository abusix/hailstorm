import{r as E}from"./index-0d5eMwbi.js";import{r as y}from"./index-p-ac5bmP.js";function x(o,h,e){let s=e.initialDeps??[],t;return()=>{var n,i,r,l;let u;e.key&&((n=e.debug)!=null&&n.call(e))&&(u=Date.now());const c=o();if(!(c.length!==s.length||c.some((g,d)=>s[d]!==g)))return t;s=c;let m;if(e.key&&((i=e.debug)!=null&&i.call(e))&&(m=Date.now()),t=h(...c),e.key&&((r=e.debug)!=null&&r.call(e))){const g=Math.round((Date.now()-u)*100)/100,d=Math.round((Date.now()-m)*100)/100,M=d/16,v=(f,S)=>{for(f=String(f);f.length<S;)f=" "+f;return f};console.info(`%c⏱ ${v(d,5)} /${v(g,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*M,120))}deg 100% 31%);`,e==null?void 0:e.key)}return(l=e==null?void 0:e.onChange)==null||l.call(e,t),t}}function z(o,h){if(o===void 0)throw new Error("Unexpected undefined");return o}const T=(o,h)=>Math.abs(o-h)<1,_=(o,h,e)=>{let s;return function(...t){o.clearTimeout(s),s=o.setTimeout(()=>h.apply(this,t),e)}},R=o=>o,k=o=>{const h=Math.max(o.startIndex-o.overscan,0),e=Math.min(o.endIndex+o.overscan,o.count-1),s=[];for(let t=h;t<=e;t++)s.push(t);return s},D=(o,h)=>{const e=o.scrollElement;if(!e)return;const s=o.targetWindow;if(!s)return;const t=i=>{const{width:r,height:l}=i;h({width:Math.round(r),height:Math.round(l)})};if(t(e.getBoundingClientRect()),!s.ResizeObserver)return()=>{};const n=new s.ResizeObserver(i=>{const r=i[0];if(r!=null&&r.borderBoxSize){const l=r.borderBoxSize[0];if(l){t({width:l.inlineSize,height:l.blockSize});return}}t(e.getBoundingClientRect())});return n.observe(e,{box:"border-box"}),()=>{n.unobserve(e)}},w={passive:!0},F=typeof window>"u"?!0:"onscrollend"in window,A=(o,h)=>{const e=o.scrollElement;if(!e)return;const s=o.targetWindow;if(!s)return;let t=0;const n=F?()=>{}:_(s,()=>{h(t,!1)},o.options.isScrollingResetDelay),i=u=>()=>{t=e[o.options.horizontal?"scrollLeft":"scrollTop"],n(),h(t,u)},r=i(!0),l=i(!1);return l(),e.addEventListener("scroll",r,w),e.addEventListener("scrollend",l,w),()=>{e.removeEventListener("scroll",r),e.removeEventListener("scrollend",l)}},W=(o,h,e)=>{if(h!=null&&h.borderBoxSize){const s=h.borderBoxSize[0];if(s)return Math.round(s[e.options.horizontal?"inlineSize":"blockSize"])}return Math.round(o.getBoundingClientRect()[e.options.horizontal?"width":"height"])},j=(o,{adjustments:h=0,behavior:e},s)=>{var t,n;const i=o+h;(n=(t=s.scrollElement)==null?void 0:t.scrollTo)==null||n.call(t,{[s.options.horizontal?"left":"top"]:i,behavior:e})};class B{constructor(h){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const s=()=>e||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:e=new this.targetWindow.ResizeObserver(t=>{t.forEach(n=>{this._measureElement(n.target,n)})}));return{disconnect:()=>{var t;return(t=s())==null?void 0:t.disconnect()},observe:t=>{var n;return(n=s())==null?void 0:n.observe(t,{box:"border-box"})},unobserve:t=>{var n;return(n=s())==null?void 0:n.unobserve(t)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([s,t])=>{typeof t>"u"&&delete e[s]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:R,rangeExtractor:k,onChange:()=>{},measureElement:W,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,...e}},this.notify=(e,s)=>{var t,n;const{startIndex:i,endIndex:r}=this.range??{startIndex:void 0,endIndex:void 0},l=this.calculateRange();(e||i!==(l==null?void 0:l.startIndex)||r!==(l==null?void 0:l.endIndex))&&((n=(t=this.options).onChange)==null||n.call(t,this,s))},this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.observer.disconnect(),this.elementsCache.clear()},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const s=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==s){if(this.cleanup(),!s){this.notify(!1,!1);return}this.scrollElement=s,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((e=this.scrollElement)==null?void 0:e.window)??null,this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,t=>{this.scrollRect=t,this.notify(!1,!1)})),this.unsubs.push(this.options.observeElementOffset(this,(t,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<t?"forward":"backward":null,this.scrollOffset=t;const i=this.isScrolling;this.isScrolling=n,this.notify(i!==n,n)}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,s)=>{const t=new Map,n=new Map;for(let i=s-1;i>=0;i--){const r=e[i];if(t.has(r.lane))continue;const l=n.get(r.lane);if(l==null||r.end>l.end?n.set(r.lane,r):r.end<l.end&&t.set(r.lane,!0),t.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((i,r)=>i.end===r.end?i.index-r.index:i.end-r.end)[0]:void 0},this.getMeasurementOptions=x(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,s,t,n,i)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:s,scrollMargin:t,getItemKey:n,enabled:i}),{key:!1}),this.getMeasurements=x(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:s,scrollMargin:t,getItemKey:n,enabled:i},r)=>{var l;if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(a=>{this.itemSizeCache.set(a.key,a.size)}));const u=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const c=this.measurementsCache.slice(0,u);for(let a=u;a<e;a++){let m=(l=this.measurementsCache[a])==null?void 0:l.measureElement;m||(m=p=>{const I=n(a),b=this.elementsCache.get(I);if(!p){b&&(this.observer.unobserve(b),this.elementsCache.delete(I));return}b!==p&&(b&&this.observer.unobserve(b),this.observer.observe(p),this.elementsCache.set(I,p)),p.isConnected&&this.resizeItem(a,this.options.measureElement(p,void 0,this))});const g=n(a),d=this.options.lanes===1?c[a-1]:this.getFurthestMeasurement(c,a),M=d?d.end+this.options.gap:s+t,v=r.get(g),f=typeof v=="number"?v:this.options.estimateSize(a),S=M+f,C=d?d.lane:a%this.options.lanes;c[a]={index:a,start:M,size:f,end:S,key:g,lane:C,measureElement:m}}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=x(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset()],(e,s,t)=>this.range=e.length>0&&s>0?P({measurements:e,outerSize:s,scrollOffset:t}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=x(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(e,s,t,n)=>s===null?[]:e({startIndex:s.startIndex,endIndex:s.endIndex,overscan:t,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const s=this.options.indexAttribute,t=e.getAttribute(s);return t?parseInt(t,10):(console.warn(`Missing attribute name '${s}={index}' on measured element.`),-1)},this._measureElement=(e,s)=>{const t=this.indexFromElement(e),n=this.getMeasurements()[t];if(!n||!e.isConnected){this.elementsCache.forEach((r,l)=>{r===e&&(this.observer.unobserve(e),this.elementsCache.delete(l))});return}const i=this.elementsCache.get(n.key);i!==e&&(i&&this.observer.unobserve(i),this.observer.observe(e),this.elementsCache.set(n.key,e)),this.resizeItem(t,this.options.measureElement(e,s,this))},this.resizeItem=(e,s)=>{const t=this.getMeasurements()[e];if(!t)return;const n=this.itemSizeCache.get(t.key)??t.size,i=s-n;i!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(t,i,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,s)),this.notify(!0,!1))},this.measureElement=e=>{e&&this._measureElement(e,void 0)},this.getVirtualItems=x(()=>[this.getIndexes(),this.getMeasurements()],(e,s)=>{const t=[];for(let n=0,i=e.length;n<i;n++){const r=e[n],l=s[r];t.push(l)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const s=this.getMeasurements();if(s.length!==0)return z(s[O(0,s.length-1,t=>z(s[t]).start,e)])},this.getOffsetForAlignment=(e,s)=>{const t=this.getSize(),n=this.getScrollOffset();s==="auto"&&(e<=n?s="start":e>=n+t?s="end":s="start"),s==="start"?e=e:s==="end"?e=e-t:s==="center"&&(e=e-t/2);const i=this.options.horizontal?"scrollWidth":"scrollHeight",l=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[i]:this.scrollElement[i]:0)-t;return Math.max(Math.min(l,e),0)},this.getOffsetForIndex=(e,s="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=this.getMeasurements()[e];if(!t)return;const n=this.getSize(),i=this.getScrollOffset();if(s==="auto")if(t.end>=i+n-this.options.scrollPaddingEnd)s="end";else if(t.start<=i+this.options.scrollPaddingStart)s="start";else return[i,s];const r=s==="end"?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(r,s),s]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(e,{align:s="start",behavior:t}={})=>{this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,s),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:s="auto",behavior:t}={})=>{e=Math.max(0,Math.min(e,this.options.count-1)),this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const n=this.getOffsetForIndex(e,s);if(!n)return;const[i,r]=n;this._scrollToOffset(i,{adjustments:void 0,behavior:t}),t!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(e))){const[u]=z(this.getOffsetForIndex(e,r));T(u,this.getScrollOffset())||this.scrollToIndex(e,{align:r,behavior:t})}else this.scrollToIndex(e,{align:r,behavior:t})}))},this.scrollBy=(e,{behavior:s}={})=>{this.cancelScrollToIndex(),s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:s})},this.getTotalSize=()=>{var e;const s=this.getMeasurements();let t;return s.length===0?t=this.options.paddingStart:t=this.options.lanes===1?((e=s[s.length-1])==null?void 0:e.end)??0:Math.max(...s.slice(-this.options.lanes).map(n=>n.end)),t-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(e,{adjustments:s,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:s},this)},this.measure=()=>{var e,s;this.itemSizeCache=new Map,(s=(e=this.options).onChange)==null||s.call(e,this,!1)},this.setOptions(h)}}const O=(o,h,e,s)=>{for(;o<=h;){const t=(o+h)/2|0,n=e(t);if(n<s)o=t+1;else if(n>s)h=t-1;else return t}return o>0?o-1:0};function P({measurements:o,outerSize:h,scrollOffset:e}){const s=o.length-1,n=O(0,s,r=>o[r].start,e);let i=n;for(;i<s&&o[i].end<e+h;)i++;return{startIndex:n,endIndex:i}}const L=typeof document<"u"?E.useLayoutEffect:E.useEffect;function V(o){const h=E.useReducer(()=>({}),{})[1],e={...o,onChange:(t,n)=>{var i;n?y.flushSync(h):h(),(i=o.onChange)==null||i.call(o,t,n)}},[s]=E.useState(()=>new B(e));return s.setOptions(e),E.useEffect(()=>s._didMount(),[]),L(()=>s._willUpdate()),s}function U(o){return V({observeElementRect:D,observeElementOffset:A,scrollToFn:j,...o})}export{U as u};
