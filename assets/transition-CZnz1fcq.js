import{r as n,R as f}from"./index-0d5eMwbi.js";import{M as ve,L as Q,y as _,O as P,n as O,o as E,m as he,t as me,D as ee,s as pe,p as be,u as re}from"./use-sync-refs-DqQDZvJ6.js";import{f as ge}from"./use-is-mounted-DT-lZL-u.js";import{l as ne}from"./use-server-handoff-complete-JgOu4JLg.js";import{x as Te,R as Ce,i as x,c as Ee,u as te}from"./open-closed-DC3t9YEZ.js";function le(e){var r;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||((r=e.as)!=null?r:ue)!==n.Fragment||f.Children.count(e.children)===1}let U=n.createContext(null);U.displayName="TransitionContext";var Re=(e=>(e.Visible="visible",e.Hidden="hidden",e))(Re||{});function we(){let e=n.useContext(U);if(e===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}function $e(){let e=n.useContext(j);if(e===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}let j=n.createContext(null);j.displayName="NestingContext";function z(e){return"children"in e?z(e.children):e.current.filter(({el:r})=>r.current!==null).filter(({state:r})=>r==="visible").length>0}function ie(e,r){let l=pe(e),a=n.useRef([]),R=ge(),S=be(),v=E((u,t=P.Hidden)=>{let s=a.current.findIndex(({el:i})=>i===u);s!==-1&&(re(t,{[P.Unmount](){a.current.splice(s,1)},[P.Hidden](){a.current[s].state="hidden"}}),S.microTask(()=>{var i;!z(a)&&R.current&&((i=l.current)==null||i.call(l))}))}),w=E(u=>{let t=a.current.find(({el:s})=>s===u);return t?t.state!=="visible"&&(t.state="visible"):a.current.push({el:u,state:"visible"}),()=>v(u,P.Unmount)}),p=n.useRef([]),d=n.useRef(Promise.resolve()),h=n.useRef({enter:[],leave:[]}),b=E((u,t,s)=>{p.current.splice(0),r&&(r.chains.current[t]=r.chains.current[t].filter(([i])=>i!==u)),r==null||r.chains.current[t].push([u,new Promise(i=>{p.current.push(i)})]),r==null||r.chains.current[t].push([u,new Promise(i=>{Promise.all(h.current[t].map(([$,y])=>y)).then(()=>i())})]),t==="enter"?d.current=d.current.then(()=>r==null?void 0:r.wait.current).then(()=>s(t)):s(t)}),g=E((u,t,s)=>{Promise.all(h.current[t].splice(0).map(([i,$])=>$)).then(()=>{var i;(i=p.current.shift())==null||i()}).then(()=>s(t))});return n.useMemo(()=>({children:a,register:w,unregister:v,onStart:b,onStop:g,wait:d,chains:h}),[w,v,a,b,g,h,d])}let ue=n.Fragment,se=ve.RenderStrategy;function Fe(e,r){var l,a;let{transition:R=!0,beforeEnter:S,afterEnter:v,beforeLeave:w,afterLeave:p,enter:d,enterFrom:h,enterTo:b,entered:g,leave:u,leaveFrom:t,leaveTo:s,...i}=e,[$,y]=n.useState(null),o=n.useRef(null),T=le(e),F=_(...T?[o,r,y]:r===null?[]:[r]),V=(l=i.unmount)==null||l?P.Unmount:P.Hidden,{show:m,appear:W,initial:X}=we(),[C,I]=n.useState(m?"visible":"hidden"),Y=$e(),{register:M,unregister:N}=Y;O(()=>M(o),[M,o]),O(()=>{if(V===P.Hidden&&o.current){if(m&&C!=="visible"){I("visible");return}return re(C,{hidden:()=>N(o),visible:()=>M(o)})}},[C,o,M,N,m,V]);let k=ne();O(()=>{if(T&&k&&C==="visible"&&o.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[o,C,k,T]);let oe=X&&!W,Z=W&&m&&X,B=n.useRef(!1),A=ie(()=>{B.current||(I("hidden"),N(o))},Y),q=E(G=>{B.current=!0;let D=G?"enter":"leave";A.onStart(o,D,L=>{L==="enter"?S==null||S():L==="leave"&&(w==null||w())})}),J=E(G=>{let D=G?"enter":"leave";B.current=!1,A.onStop(o,D,L=>{L==="enter"?v==null||v():L==="leave"&&(p==null||p())}),D==="leave"&&!z(A)&&(I("hidden"),N(o))});n.useEffect(()=>{T&&R||(q(m),J(m))},[m,T,R]);let ce=!(!R||!T||!k||oe),[,c]=Te(ce,$,m,{start:q,end:J}),de=he({ref:F,className:((a=me(i.className,Z&&d,Z&&h,c.enter&&d,c.enter&&c.closed&&h,c.enter&&!c.closed&&b,c.leave&&u,c.leave&&!c.closed&&t,c.leave&&c.closed&&s,!c.transition&&m&&g))==null?void 0:a.trim())||void 0,...Ce(c)}),H=0;C==="visible"&&(H|=x.Open),C==="hidden"&&(H|=x.Closed),c.enter&&(H|=x.Opening),c.leave&&(H|=x.Closing);let fe=ee();return f.createElement(j.Provider,{value:A},f.createElement(Ee,{value:H},fe({ourProps:de,theirProps:i,defaultTag:ue,features:se,visible:C==="visible",name:"Transition.Child"})))}function Pe(e,r){let{show:l,appear:a=!1,unmount:R=!0,...S}=e,v=n.useRef(null),w=le(e),p=_(...w?[v,r]:r===null?[]:[r]);ne();let d=te();if(l===void 0&&d!==null&&(l=(d&x.Open)===x.Open),l===void 0)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[h,b]=n.useState(l?"visible":"hidden"),g=ie(()=>{l||b("hidden")}),[u,t]=n.useState(!0),s=n.useRef([l]);O(()=>{u!==!1&&s.current[s.current.length-1]!==l&&(s.current.push(l),t(!1))},[s,l]);let i=n.useMemo(()=>({show:l,appear:a,initial:u}),[l,a,u]);O(()=>{l?b("visible"):!z(g)&&v.current!==null&&b("hidden")},[l,g]);let $={unmount:R},y=E(()=>{var F;u&&t(!1),(F=e.beforeEnter)==null||F.call(e)}),o=E(()=>{var F;u&&t(!1),(F=e.beforeLeave)==null||F.call(e)}),T=ee();return f.createElement(j.Provider,{value:g},f.createElement(U.Provider,{value:i},T({ourProps:{...$,as:n.Fragment,children:f.createElement(ae,{ref:p,...$,...S,beforeEnter:y,beforeLeave:o})},theirProps:{},defaultTag:n.Fragment,features:se,visible:h==="visible",name:"Transition"})))}function Se(e,r){let l=n.useContext(U)!==null,a=te()!==null;return f.createElement(f.Fragment,null,!l&&a?f.createElement(K,{ref:r,...e}):f.createElement(ae,{ref:r,...e}))}let K=Q(Pe),ae=Q(Fe),xe=Q(Se),Ne=Object.assign(K,{Child:xe,Root:K});export{xe as F,Ne as z};
